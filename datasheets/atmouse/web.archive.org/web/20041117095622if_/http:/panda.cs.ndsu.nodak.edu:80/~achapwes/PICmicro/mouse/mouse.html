<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
    
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
    
  <meta name="GENERATOR"
 content="Mozilla/4.7 [en] (Win98; U) [Netscape]">
    
  <meta name="Author" content="Adam Chapweske">
  <title>PS/2 Mouse Interfacing</title>
     <!--This file created 10:20 PM  3/29/01 by Claris Home Page version 3.0-->
</head>
  <body bgcolor="#ffffff" link="#3333ff" vlink="#3333ff" alink="#3333ff">
<x-claris-window top="0" bottom="603" left="0" right="1012"> <x-claris-tagview
 mode="minimal"> <!--This file created 8:24 PM  3/26/01 by Claris Home Page version 3.0--> 
 &nbsp; </x-claris-tagview></x-claris-window>
<table border="0" cellspacing="0" cellpadding="4" cols="1" width="100%"
 bgcolor="#faf0e6">
 <tbody>
    <tr>
 <td> 
      <center><font size="+2">The PS/2 Mouse Interface</font> <br>
This article is Copyright 2001, Adam Chapweske&nbsp; <br>
      <br>
      </center>
  
      <p><b>Electrical Interface / Protocol:</b> </p>
      <p>The PS/2 mouse uses the same protocol as the PS/2 (AT) keyboard.&nbsp; 
This standard originally appeared in the IBM technical reference manual, but
I am not aware of any current official publication of this standard.&nbsp; 
However, you may click <a
 href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/PS2/ps2.htm">here</a> 
for the (detailed) information I have gathered about that protocol. </p>
      <p><b>Inputs, Resolution, and Scaling:</b> </p>
      <p>The standard PS/2 mouse supports the following inputs: X (right/left) 
movement, Y (up/down) movement, left button, middle button, and right button. 
The mouse reads these inputs at a regular freqency and updates various counters
and flags to reflect movement and button states.&nbsp; There are many PS/2
pointing devices that have additional inputs and may report data differently
than described in this document.&nbsp; One popular extension I cover later
in this document is the Microsoft Intellimouse, which includes support for
the standard inputs as well as a scrolling wheel and two additional buttons. 
      </p>
      <p>The standard mouse has two counters that keep track of movement:
the X-movement counter and the Y-movement counter.&nbsp; These&nbsp; are
9-bit 2's complement values and each has an associated overflow flag.&nbsp;
Their contents, along with the state of the three mouse buttons, are sent
to the host in the form of a 3-byte movement data packet (as described in 
the next section.)&nbsp; The movement counters represent the amount of movement
that has occurred since the last movment data packet was sent to the host. 
      </p>
      <p>When the mouse reads its inputs, it records the current state of
its buttons, then checks for movement. If movement has occurred, it increments 
(for +X or +Y movement) or decrements (for -X or -Y movement) its X and/or 
Y movement counters. If either of the counters has overflowed, it sets the
appropriate overflow flag. </p>
      <p>The parameter that determines the amount by which the movement counters 
are incremented/decremented is the <i>resolution</i>. The default resolution 
is 4 counts/mm and the host may change that value using the "Set Resolution" 
(0xE8) command. </p>
      <p>There is a parameter that does not effect the movement counters,
but does effect the reported<a href="mouse.html#Footnotes">(1)</a> value of these counters.&nbsp; 
This parameter is <i>scaling</i>.&nbsp; By default, the mouse uses 1:1 scaling,
which has no effect on the reported mouse movement.&nbsp; However, the host
may select 1:2 scaling by sending the "Set Scaling 2:1" (0xE7) command.&nbsp;
If 2:1 scaling is enabled, the mouse will apply the following algorithm to
the counters before sending their contents to the host: <br>
&nbsp; <br>
&nbsp; </p>
      <center>
      <table border="1" cols="2" width="300">
 <tbody>
          <tr>
 <td> 
            <center>Movement Counter</center>
 </td>
  <td> 
            <center>Reported Movement</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>0</center>
 </td>
  <td> 
            <center>0</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>1</center>
 </td>
  <td> 
            <center>1</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>2</center>
 </td>
  <td> 
            <center>1</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>3</center>
 </td>
  <td> 
            <center>3</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>4</center>
 </td>
  <td> 
            <center>6</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>5</center>
 </td>
  <td> 
            <center>9</center>
 </td>
 </tr>
  <tr>
 <td> 
            <center>N &gt; 5</center>
 </td>
  <td> 
            <center>2 * N</center>
 </td>
 </tr>
 
        </tbody>
      </table>
      </center>
  
      <p><b>Movement Data Packet:</b> </p>
      <p>The standard PS/2 mouse sends movement (and button) information
to the host using the following 3-byte packet <a href="mouse.html#Footnotes">(4)</a>: 
      </p>
      <blockquote>&nbsp; 
        <table border="0" cellspacing="0" cellpadding="0" width="650">
 <tbody>
            <tr>
 <td> <br>
              <font face="Arial,Helvetica"><font size="-1">Byte 1&nbsp;</font></font></td>
  <td> 
              <table border="0" cellpadding="0" cols="8" width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center>Bit 7</center>
 </td>
  <td> 
                    <center>Bit 6</center>
 </td>
  <td> 
                    <center>Bit 5</center>
 </td>
  <td> 
                    <center>Bit 4</center>
 </td>
  <td> 
                    <center>Bit 3</center>
 </td>
  <td> 
                    <center>Bit 2</center>
 </td>
  <td> 
                    <center>Bit 1</center>
 </td>
  <td> 
                    <center>Bit 0</center>
 </td>
 </tr>
 
                </tbody>
              </table>
  
              <table border="1" cellspacing="0" cellpadding="0" cols="8"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Y
overflow</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">X
overflow</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Y
sign bit</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">X
sign bit</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Always
1</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Middle
Btn</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Right
Btn</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Left
Btn</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 2</font></font></td>
  <td> 
              <table border="1" cellspacing="0" cellpadding="0" cols="1"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">X
Movement</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 3&nbsp;</font></font></td>
  <td> 
              <table border="1" cellspacing="0" cellpadding="0" cols="1"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Y
Movement</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
 
          </tbody>
        </table>
 </blockquote>
 The movement counters are 9-bit 2's complement integers, where the most significant
bit appears as a sign bit in Byte 1 of the movement data packet. These counters
are updated when the mouse reads its input and finds movement has occurred.
Their value is the amount of movement that has occurred since the last movement
data packet was sent to the host (ie, after a packet is sent to the host,
the movement counters are reset.) The range of values that can be expressed
by the movement counters is -255 to +255. If this range is exceeded, the
appropriate overflow bit is set and the counter is not incremented/decremented
until it is reset. 
      <p>As I mentioned earlier, the movement counters are reset whenever
a movement data packet is successfully sent to the host. They are also reset
after the mouse receives any command from the host other than the "Resend"
(0xFE) command. </p>
      <p><b>Modes of Operation:</b> </p>
      <p>Data reporting is handled according to the mode in which the mouse
is operating.&nbsp; There are four standard modes of operation:&nbsp; </p>
      <ul>
 <li> <i>Reset</i> - The mouse enters Reset mode at power-up or after receiving 
the "Reset" (0xFF) command.&nbsp;</li>
  <li> <i>Stream</i> - This is the default mode (after Reset finishes executing) 
and is the mode in which most software uses the mouse.&nbsp; If the host has
previously set the mouse to Remote mode, it may re-enter Stream mode by sending
the "Set Stream Mode" (0xEA) command to the mouse.&nbsp;</li>
  <li> <i>Remote</i> - Remote mode is useful in some situations and may be
entered by sending the "Set Remote Mode" (0xF0) command to the mouse.&nbsp;</li>
  <li> <i>Wrap</i> - This mode isn't particularly useful except for testing
the connection between the mouse and its host.&nbsp; Wrap mode may be entered 
by sending the "Set Wrap Mode" (0xEE) command to the mouse.&nbsp; To exit 
Wrap mode, the host must issue the "Reset" (0xFF) command or "Reset Wrap Mode"
(0xEC) command.&nbsp; If the "Reset" (0xFF) command is recieved, the mouse
will enter Reset mode.&nbsp; If the "Reset Wrap Mode" (0xEC) command is received,
the mouse will enter the mode it was in prior to Wrap Mode.</li>
 
      </ul>
 (Note: The mouse may also enter "extended" modes of operation, as described 
later in this document.&nbsp; However, this is not a feature of the standard 
PS/2 mouse.) 
      <p><b>Reset Mode:</b> </p>
      <p>The mouse enters reset mode at power-on or in response to the "Reset" 
(0xFF) command. After entring this mode, the mouse performs a diagnostic self-test
referred to as BAT (Basic Assurance Test) and sets the follwing default values: 
      </p>
      <ul>
 <li> Sample Rate - 100 samples/sec</li>
  <li> Resolution - 4 counts/mm</li>
  <li> Scaling - 1:1</li>
  <li> Data Reporting Disabled</li>
 
      </ul>
 It then sends a BAT completion code of either 0xAA (BAT successful) or 0xFC
(Error). If the host receives a response other than 0xAA, it may cycle the
mouse's power supply, causing the mouse to reset and re-execute its BAT. 
      <p>Following the BAT completion code (0xAA or 0xFC), the mouse sends
its device ID of 0x00. This distinguishes it from a keyboard, or a mouse
in an extended mode. I have read documents saything the host is not <i>supposed</i> 
to transmit any data until it receives a device ID.&nbsp; However I've found
that some BIOS's will send the "Reset" (0xFF) command immediately following
the 0xAA received after a power-on reset. </p>
      <p>After the mouse has sent its device ID to the host, it will enter
Stream Mode.&nbsp; Note that one of the default values set by the mouse is
"Data Reporting Disabled".&nbsp; This means the mouse will not send any movement 
data packets to the host until the "Enable Data Reporting" (0xF4) command 
is received. </p>
      <p><b>Stream Mode:</b> </p>
      <p>In stream mode, the mouse sends movement data when it detects movement 
or a change in state of one or more mouse buttons. The maximum rate at which
this data reporting may occur is known as the <i>sample rate</i>.&nbsp; This
parameter ranges from 10 samples/sec to 200 samples/sec. Its default value
is 100 samples/sec and the host may change that value by using the "Set Sample
Rate" (0xF3) command.&nbsp; Stream mode is the default mode of operation. 
      </p>
      <p><b>Remote Mode:</b> </p>
      <p>In this mode, the mouse reads its inputs and updates its counters/flags 
at the current sampling rate, but it only notifies the host of movement (and
change in button state) when that information is requested by the host. The
host does this by issuing the "Read Data" (0xEB) command. After receiveing
this command, the mouse will send a movement data packet, and reset its movement
counters. </p>
      <p><b>Wrap Mode:</b> </p>
      <p>This is an "echoing" mode in which every byte received by the mouse 
is sent back to the host. Even if the byte represents a valid command, the
mouse will not respond to that command--it will only echo that byte back
to the host. There are two exceptions to this: the "Reset" (0xFF) command
and "Reset Wrap Mode" (0xEC) command. The mouse treats these as valid commands
and does not echo them back to the host. </p>
      <p><b>Intellimouse Extensions:</b> </p>
      <p>A popular extension to the standard PS/2 mouse is the Microsoft
Intellimouse.&nbsp; This includes support for a total of five mouse buttons
and three axises of movement (right-left, up-down, and a scrolling wheel).&nbsp;
These additional features require the use of a 4-byte movement data packet
rather than the standard 3-byte packet.&nbsp; Since standard PS/2 mouse drivers
cannot recognize this packet format, the Microsoft Intellimouse is required
to operate exactly like a standard PS/2 mouse unless it knows the drivers 
support the extended packet format.&nbsp; This way, if a Microsoft Intellimouse 
is used on a computer which only supports the standard PS/2 mouse, the Microsoft
Intellimouse will still function, except for its scrolling wheel and 4th
and 5th buttons. </p>
      <p>The Microsoft Intellimouse operates just like a standard PS/2 mouse 
(ie, it uses a 3-byte movement data packet, responds to all commands in the
same way as a standard PS/2 mouse, and reports a device ID of 0x00.)&nbsp; 
To enter scrolling wheel mode, the host sends the following command sequence: 
      </p>
      <blockquote>Set sample rate 200 <br>
Set sample rate 100 <br>
Set sample rate 80</blockquote>
 The host then issues the "Get device ID" command (0xF2) and waits for a response.&nbsp;
If a standard PS/2 mouse (ie, non-Intellimouse) is attached, it will respond
with a device ID of 0x00.&nbsp; In this case, the host will recognize the
fact that the mouse does have a scrolling wheel and will continue to treat
it as a standard PS/2 mouse.&nbsp; However, if a Microsoft Intellimouse is
attached, it will respond with an ID of 0x03.&nbsp; This tells the host that
the attached pointing device has a scrolling wheel and the host will then
expect the mouse to use the following 4-byte movement data packet: 
      <blockquote>&nbsp; 
        <table border="0" cellspacing="0" cellpadding="0" width="650">
 <tbody>
            <tr>
 <td> <br>
              <font face="Arial,Helvetica"><font size="-1">Byte 1&nbsp;</font></font></td>
  <td> 
              <table border="0" cellpadding="0" cols="8" width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center>Bit 7</center>
 </td>
  <td> 
                    <center>Bit 6</center>
 </td>
  <td> 
                    <center>Bit 5</center>
 </td>
  <td> 
                    <center>Bit 4</center>
 </td>
  <td> 
                    <center>Bit 3</center>
 </td>
  <td> 
                    <center>Bit 2</center>
 </td>
  <td> 
                    <center>Bit 1</center>
 </td>
  <td> 
                    <center>Bit 0</center>
 </td>
 </tr>
 
                </tbody>
              </table>
  
              <table border="1" cellspacing="0" cellpadding="0" cols="8"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Y
overflow</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">X
overflow</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Y
sign bit</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">X
sign bit</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Always
1</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Middle
Btn</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Right
Btn</font></font></center>
 </td>
  <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Left
Btn</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 2</font></font></td>
  <td> 
              <table border="1" cellspacing="0" cellpadding="0" cols="1"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">X
Movement</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 3&nbsp;</font></font></td>
  <td> 
              <table border="1" cellspacing="0" cellpadding="0" cols="1"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Y
Movement</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 4</font></font></td>
  <td> 
              <table border="1" cellspacing="0" cellpadding="0" cols="1"
 width="100%">
 <tbody>
                  <tr>
 <td> 
                    <center><font face="Arial,Helvetica"><font size="-1">Z
Movement</font></font></center>
 </td>
 </tr>
 
                </tbody>
              </table>
 </td>
 </tr>
 
          </tbody>
        </table>
 Z Movement is a 2's complement number that represents the scrolling wheel's 
movement since the last data report.&nbsp; Valid values are in the range of
-8 to +7. This means the number is actually represented only by the least
significant four bits; the upper four bits act only as sign extension bits.</blockquote>
 To enter scrolling wheel + 5 button mode, the host sends the following command
sequence: 
      <blockquote>Set sample rate 200 <br>
Set sample rate 200 <br>
Set sample rate 80</blockquote>
 The host then issues the "Get device ID" command (0xF2) and waits for a response.&nbsp;
A Microsoft Intellimouse will respond with a device ID of 0x04, then use
the following 4-byte movement data packet: 
      <blockquote> 
        <blockquote>&nbsp; 
          <table border="0" cellspacing="0" cellpadding="0" width="650">
 <tbody>
              <tr>
 <td> <br>
                <font face="Arial,Helvetica"><font size="-1">Byte 1&nbsp;</font></font></td>
  <td> 
                <table border="0" cellpadding="0" cols="8" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center>Bit 7</center>
 </td>
  <td> 
                      <center>Bit 6</center>
 </td>
  <td> 
                      <center>Bit 5</center>
 </td>
  <td> 
                      <center>Bit 4</center>
 </td>
  <td> 
                      <center>Bit 3</center>
 </td>
  <td> 
                      <center>Bit 2</center>
 </td>
  <td> 
                      <center>Bit 1</center>
 </td>
  <td> 
                      <center>Bit 0</center>
 </td>
 </tr>
 
                  </tbody>
                </table>
  
                <table border="1" cellspacing="0" cellpadding="0"
 cols="8" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Y overflow</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">X overflow</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Y sign bit</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">X sign bit</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Always 1</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Middle Btn</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Right Btn</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Left Btn</font></font></center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 2</font></font></td>
  <td> 
                <table border="1" cellspacing="0" cellpadding="0"
 cols="1" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">X Movement</font></font></center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 3&nbsp;</font></font></td>
  <td> 
                <table border="1" cellspacing="0" cellpadding="0"
 cols="1" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Y Movement</font></font></center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 4</font></font></td>
  <td> 
                <table border="1" cellspacing="0" cellpadding="0"
 cols="8" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Always 0</font></font></center>
 </td>
  <td> 
                      <center>Always 0</center>
 </td>
  <td> 
                      <center>5th Btn</center>
 </td>
  <td> 
                      <center>4th Btn</center>
 </td>
  <td> 
                      <center>Z3</center>
 </td>
  <td> 
                      <center>Z2</center>
 </td>
  <td> 
                      <center>Z1</center>
 </td>
  <td> 
                      <center>Z0</center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
 
            </tbody>
          </table>
 Z0-Z3 is a 2's complement number which represents the amount of movement 
that has occurred since the last data report.&nbsp; Valid values range from
-8 to +7. <br>
4th Btn: 1 = 4th mouse button is pressed; 0 = 4th mouse button is not pressed. 
          <br>
5th Btn: 1 = 5th mouse button is pressed; 0 = 5th mouse button is not pressed.</blockquote>
 </blockquote>
 You may have seen mice with two scrolling wheels--one vertical and the other
horizontal.&nbsp; These mice use the Microsoft Intellimouse data packet format
as described above.&nbsp; If the vertical wheel is scrolled upward, the Z-counter
is incremented by one and if that wheel is scrolled down, the Z-counter is
decremented by one.&nbsp; This is normal operation for a scrolling wheel.&nbsp;
However, if the <i>horizontal</i> wheel is scrolled right, the Z-counter
is incremented by <i>two</i> and if it is scrolled left, the Z-counter is
decremented by <i>two</i>.&nbsp; This seems like an odd way to implement
the second scrolling wheel, but it works since the placement of the two wheels
make it impossible to use both of them at the same time (and if you try to
trick the software and use both at the same time, it will ignore the horizontal
wheel.) 
      <p><b>Command Set:</b> </p>
      <p>The following are the only commands that may be sent to the mouse... 
If the mouse is in Stream mode, the host should disable data reporting (command
0xF5) before sending any other commands... </p>
      <ul>
 <li> 0xFF (Reset) - The mouse responds to this command with "acknowledge"
(0xFA) then enters Reset Mode.</li>
  <li> 0xFE (Resend) - The host sends this command whenever it receives invalid 
data from the mouse. The mouse responds by resending the last<a
 href="mouse.html#Footnotes">(2)</a> packet<a href="mouse.html#Footnotes">(3)</a> it sent to
the host.&nbsp;&nbsp; If the mouse responds to the "Resend" command with
another invalid packet, the host may either issue another "Resend" command,
issue an "Error" command, cycle the mouse's power supply to reset the mouse,
or it may inhibit communication (by bringing the Clock line low).&nbsp; The
action taken depends on the host.</li>
  <li> 0xF6 (Set Defaults) - The mouse responds with "acknowledge" (0xFA)
then loads the following values:&nbsp; Sampling rate = 100, Resolution =
4 counts/mm, Scaling = 1:1, Disable Data Reporting.&nbsp; The mouse then
resets its movement counters and enters stream mode.</li>
  <li> 0xF5 (Disable Data Reporting) - The mouse responds with "acknowledge"
(0xFA) then disables data reporting and resets its movement counters.&nbsp;
This only effects data reporting in Stream mode and does not disable sampling.&nbsp; 
Disabled stream mode funcions the same as remote mode.</li>
  <li> 0xF4 (Enable Data Reporting) - The mouse responds with "acknowledge"
(0xFA) then enables data reporting and resets its movement counters.&nbsp;
This command may be issued while the mouse is in Remote Mode (or Stream mode), 
but it will only effect data reporting in Stream mode.</li>
  <li> 0xF3 (Set Sample Rate) - The mouse responds with "acknowledge" (0xFA)
then reads one more byte from the host.&nbsp; The mouse saves this byte as
the new sample rate. After receiving the sample rate, the mouse again responds 
with "acknowledge" (0xFA) and resets its movement counters.&nbsp; Valid sample
rates are 10, 20, 40, 60, 80, 100, and 200 samples/sec.</li>
  <li> 0xF2 (Get Device ID) - The mouse responds with "acknowledge" (0xFA)
followed by its device ID (0x00 for the standard PS/2 mouse.)&nbsp; The mouse
should also reset its movement counters.</li>
  <li> 0xF0 (Set Remote Mode) - The mouse responds with "acknowledge" (0xFA)
then resets its movement counters and enters remote mode.</li>
  <li> 0xEE (Set Wrap Mode) - The mouse responds with "acknowledge" (0xFA)
then resets its movement counters and&nbsp; enters wrap mode.</li>
  <li> 0xEC (Reset Wrap Mode) - The mouse responds with "acknowledge" (0xFA)
then resets its movement counters and enters the mode it was in prior to
wrap mode (Stream Mode or Remote Mode.)</li>
  <li> 0xEB (Read Data) - The mouse responds with acknowledge (0xFA) then
sends a movement data packet. This is the only way to read data in Remote
Mode.&nbsp; After the data packets has been successfully sent, it resets
its movement counters.</li>
  <li> 0xEA (Set Stream Mode) - The mouse responds with "acknowledge" then
resets its movement counters and enters steram mode.</li>
  <li> 0xE9 (Status Request) - The mouse responds with "acknowledge" then
sends the following 3-byte status packet (then resets its movement counters.):&nbsp;</li>
  
        <ul>
 <li> &nbsp;</li>
  
          <table border="0" cellspacing="0" cellpadding="0" width="650">
 <tbody>
              <tr>
 <td> <br>
                <font face="Arial,Helvetica"><font size="-1">Byte 1&nbsp;</font></font></td>
  <td> 
                <table border="0" cellpadding="0" cols="8" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center>Bit 7</center>
 </td>
  <td> 
                      <center>Bit 6</center>
 </td>
  <td> 
                      <center>Bit 5</center>
 </td>
  <td> 
                      <center>Bit 4</center>
 </td>
  <td> 
                      <center>Bit 3</center>
 </td>
  <td> 
                      <center>Bit 2</center>
 </td>
  <td> 
                      <center>Bit 1</center>
 </td>
  <td> 
                      <center>Bit 0</center>
 </td>
 </tr>
 
                  </tbody>
                </table>
  
                <table border="1" cellspacing="0" cellpadding="0"
 cols="8" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Always 0</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Mode</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Enable</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Scaling</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Always 0</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Left Btn</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Middle Btn</font></font></center>
 </td>
  <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Right Btn</font></font></center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 2</font></font></td>
  <td> 
                <table border="1" cellspacing="0" cellpadding="0"
 cols="1" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Resolution</font></font></center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
  <tr>
 <td><font face="Arial,Helvetica"><font size="-1">Byte 3&nbsp;</font></font></td>
  <td> 
                <table border="1" cellspacing="0" cellpadding="0"
 cols="1" width="100%">
 <tbody>
                    <tr>
 <td> 
                      <center><font face="Arial,Helvetica"><font
 size="-1">Sample Rate</font></font></center>
 </td>
 </tr>
 
                  </tbody>
                </table>
 </td>
 </tr>
 
            </tbody>
          </table>
  
          <p><i>Right, Middle, Left Btn</i> = 1 if button pressed; 0 if button
is not pressed. <br>
          <i>Scaling</i> = 1 if scaling is 2:1; 0 if scaling is 1:1. (See
commands 0xE7 and 0xE6) <br>
          <i>Enable</i> = 1 if data reporting is enabled; 0 if data reporting 
is disabled. (See commands 0xF5 and 0xF4) <br>
          <i>Mode</i> = 1 if Remote Mode is enabled; 0 if Stream mode is
enabled. (See commands 0xF0 and 0xEA) <br>
&nbsp;</p>
        </ul>
  <li> 0xE8 (Set Resolution) - The mouse responds with acknowledge (0xFA)
then reads one byte from the host and again responds with acknowledge (0xFA) 
then resets its movement counters.&nbsp; The byte read from the host determines 
the resolution as follows:&nbsp;</li>
  <br>
&nbsp; 
        <center>
        <table border="1" width="300">
 <tbody>
            <tr>
 <td> 
              <center>Byte Read from Host</center>
 </td>
  <td> 
              <center>Resolution</center>
 </td>
 </tr>
  <tr>
 <td> 
              <center>0x00</center>
 </td>
  <td> 
              <center>1 count/mm</center>
 </td>
 </tr>
  <tr>
 <td> 
              <center>0x01</center>
 </td>
  <td> 
              <center>2 count/mm</center>
 </td>
 </tr>
  <tr>
 <td> 
              <center>0x02</center>
 </td>
  <td> 
              <center>4 count/mm</center>
 </td>
 </tr>
  <tr>
 <td> 
              <center>0x03</center>
 </td>
  <td> 
              <center>8 count/mm</center>
 </td>
 </tr>
 
          </tbody>
        </table>
        </center>
 
      </ul>
  
      <ul>
 <li> 0xE7 (Set Scaling 2:1) - The mouse responds with acknowledge (0xFA)
then enables 2:1 scaling (discussed earlier in this document.)</li>
  <li> 0xE6 (Set Scaling 1:1) - The mouse responds with acknowledge (0xFA)
then enables 1:1 scaling (discussed earlier in this document.)</li>
 
      </ul>
 The only commands the standard PS/2 mouse will send to the host are the "Resend"
(0xFE) and "Error" (0xFC) commands.&nbsp; They both work the same as they
do as host-to-device commands.&nbsp; 
      <p><b>Initialization:</b> </p>
      <p>The PS/2 mouse is normally detected/initialized only when the computer 
is booting up.&nbsp; That is, the mouse is not hot-pluggable and you must 
restart your computer whenever you add/remove a PS/2 mouse (furthermore, some
motherboards may be damaged if you add/remove a PS/2 mouse while the computer
is running.) </p>
      <p>The initial detection of the PS/2 mouse occurrs during POST.&nbsp;
If a mouse is detected, the BIOS will allow the operating system to configure/enable 
the mouse.&nbsp; Otherwise, it will inhibit communication on the mouse's bus.&nbsp;
If you boot the computer with a mouse attached, then detach/reattach the
mouse while in Windows, the OS <i>may</i> be able to detect the mouse was
reattached.&nbsp; Microsoft tried to support this, but it only works about
50% of the time. </p>
      <p>The following is the communication between my computer (running
Win98SE) and mouse when it boots up with a standard PS/2 mouse attached.&nbsp;
It is fairly typical of how a PS/2 mouse is initialized and if you want to 
emulate a PS/2 mouse it must (at minimum) be able to support the following 
sequence of commands...&nbsp; </p>
      <ul>
 <li> <tt>Power-on Reset:</tt></li>
  <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; FF&nbsp; Reset command</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; FF&nbsp; Reset command</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; FF&nbsp; Reset command</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; : Attempt to
Enter Microsoft</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Scrolling Mouse mode</tt> <br>
        <tt>Host:&nbsp; C8&nbsp; decimal 200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 64&nbsp; decimal 100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 50&nbsp; decimal 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F2&nbsp; Read Device Type&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Response 03 if microsoft scrolling mouse</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; 0A&nbsp; decimal 10</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; F2&nbsp; Read Device Type</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; E8&nbsp; Set resolution</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; 03&nbsp; 8 Counts/mm</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; E6&nbsp; Set Scaling 1:1</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; 28&nbsp; decimal 40</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; F4&nbsp; Enable</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Initialization complete...</tt> 
        <p><tt>If I then press the Left Button...</tt> <br>
        <tt>Mouse: 09 1 1 00001001; bit0 = Left button state; bit3 = always 
1</tt> <br>
        <tt>Mouse: 00 1 1 No X-movement</tt> <br>
        <tt>Mouse: 00 1 1 No Y-movement</tt> <br>
        <tt>... and release the Left Button:</tt> <br>
        <tt>Mouse: 08 0 1 00001000 bit0 = Left button state; bit3 = always 
1</tt> <br>
        <tt>Mouse: 00 1 1 No X-movement</tt> <br>
        <tt>Mouse: 00 1 1 No Y-movement</tt></p>
      </ul>
 The following is the communication between my computer (running Win98SE) 
and mouse when it boots up with an (emulated) Intellimouse...&nbsp; 
      <ul>
 <li> <tt>Power-on Reset:</tt></li>
  <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; FF&nbsp; Reset command</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; FF&nbsp; Reset command</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; FF&nbsp; Reset command</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Mouse: AA&nbsp; Self-test passed</tt> <br>
        <tt>Mouse: 00&nbsp; Mouse ID</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; : Attempt to
Enter Microsoft&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Scrolling Mouse mode</tt> <br>
        <tt>Host:&nbsp; C8&nbsp; decimal 200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 64&nbsp; decimal 100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 50&nbsp; decimal 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F2&nbsp; Read Device Type&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: 03&nbsp; Mouse ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Response 03 if microsoft scrolling mouse</tt> <br>
        <tt>Host:&nbsp; E8&nbsp; Set Resolution&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;</tt> <br>
        <tt>Host:&nbsp; 03&nbsp; 8 counts/mm</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; E6&nbsp; Set scaling 1:1</tt> <br>
        <tt>Dev:&nbsp;&nbsp; FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; 28&nbsp; decimal 40</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> <br>
        <tt>Host:&nbsp; F4&nbsp; Enable device&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge</tt> 
        <p><tt>If I then press the left mouse button:</tt> <br>
        <tt>Mouse: 09&nbsp; 00001001 bit0 = Left button state; bit3 = always 
1</tt> <br>
        <tt>Mouse: 00&nbsp; No X-movement</tt> <br>
        <tt>Mouse: 00&nbsp; No Y-movement</tt> <br>
        <tt>Mouse: 00&nbsp; No Z-movement</tt> </p>
        <p><tt>...and then release the left mouse button button:</tt> <br>
        <tt>Mouse: 08&nbsp; 00001000 bit0 = Left button state; bit3 = always 
1</tt> <br>
        <tt>Mouse: 00&nbsp; No X-movement</tt> <br>
        <tt>Mouse: 00&nbsp; No Y-movement</tt> <br>
        <tt>Mouse: 00&nbsp; No Z-movement</tt></p>
      </ul>
 <tt>After I downloaded/installed the Microsoft's Intellimouse drivers with 
support for the 4th and 5th buttons, the following sequence was found:</tt> 
      <blockquote><tt>... (starts same as before) ...</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; : Attempt to
Enter Microsoft&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Scrolling Mouse mode.</tt> <br>
        <tt>Host:&nbsp; C8&nbsp; decimal 200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 64&nbsp; decimal 100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 50&nbsp; decimal 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F2&nbsp; Read Device Type&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: 03&nbsp; Mouse ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Response 03 if microsoft scrolling mouse.</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; : Attempt to
Enter Microsoft 5-button&nbsp;</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Scrolling Mouse mode.</tt> <br>
        <tt>Host:&nbsp; C8&nbsp; decimal 200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; C8&nbsp; decimal 200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F3&nbsp; Set Sample Rate&nbsp;&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; 50&nbsp; decimal 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Host:&nbsp; F2&nbsp; Read Device Type&nbsp; :</tt> <br>
        <tt>Mouse: FA&nbsp; Acknowledge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
:</tt> <br>
        <tt>Mouse: 04&nbsp; Mouse ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
: Response 04 if 5-button scrolling mouse.</tt> <br>
        <tt>... rest of initialization same as before ...</tt></blockquote>
 <b>Emulation/Interfacing:</b> 
      <ul>
 <li> Click <a
 href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/code/ps2/Device.html">here</a> 
for routines that emulate a PS/2 mouse or keyboard</li>
  <li> Click <a
 href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/code/ps2/Host.html">here</a> 
for routines that emulate a PS/2 host (ie, interface a mouse/keyboard)</li>
  <li> Click <a
 href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/code/Projects/mouse/ps2mouse.html">here</a> 
for a fully-functional PS/2 mouse written for the PIC16F84.</li>
 
      </ul>
 If you want to build a truely fully-implemented mouse or host, you should 
implement all of the features described in this document (except for, of course,
the Microsoft Intellimouse extensions, which are optional).&nbsp; However,
at an absolute minimum, your device should operate as follows: 
      <blockquote>To Emulate a Mouse: 
        <ul>
 <li> Never send data when&nbsp; the "Clock" line low.&nbsp; If the host
pulls the "Data" line low, prepare to read a byte from the host.</li>
  <li> ~500 milliseconds after powerup, transmit "0xAA, 0x00".</li>
  <li> Wait for the host to send the enable (0xF4) command before sending
any movement/button data.</li>
  <li> Emulate the various mouse functions as follows:</li>
  
          <table border="1" cellspacing="0" width="500">
 <tbody>
              <tr>
 <td> 
                <center><b>Emulated Action</b></center>
 </td>
  <td> 
                <center><b>Data sent to host</b></center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Move up one</center>
 </td>
  <td> 
                <center>0x08,0x00,0x01</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Move down one</center>
 </td>
  <td> 
                <center>0x28,0x00,0xFF</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Move right one</center>
 </td>
  <td> 
                <center>0x08,0x01,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Move left one</center>
 </td>
  <td> 
                <center>0x18,0xFF,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Press left button</center>
 </td>
  <td> 
                <center>0x09,0x00,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Release left button</center>
 </td>
  <td> 
                <center>0x08,0x00,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Press middle button</center>
 </td>
  <td> 
                <center>0x0C,0x00,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Release middle button</center>
 </td>
  <td> 
                <center>0x08,0x00,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Press right button</center>
 </td>
  <td> 
                <center>0x0A,0x00,0x00</center>
 </td>
 </tr>
  <tr>
 <td> 
                <center>Release right button</center>
 </td>
  <td> 
                <center>0x08,0x00,0x00</center>
 </td>
 </tr>
 
            </tbody>
          </table>
  <li> Respond to the "Reset" (0xFF) command with "0xFA" then goto the beginning 
of your program. (ie, send 0xAA, 0x00, then wait for the enable command before
sending any movement/button data.)</li>
  <li> Respond to the "Get Device ID" (0xF2) command with "0xFA, 0x00".</li>
  <li> Respond to the "Status Request" (0xE9) command with "0xFA, 0x00, 0x02, 
0x64".</li>
  <li> Respond to all other commands with acknowledge (0xFA).</li>
 
        </ul>
 To Interface a Mouse: 
        <ul>
 <li> Wait for the mouse to send "0xAA", then send the "Enable" (0xF4) command.</li>
  <li> The mouse will then send a 3-byte movement packets as described earlier 
in this document.</li>
 
        </ul>
 </blockquote>
  
      <p><br>
      <a name="Footnotes"></a><b>Footnotes:</b> </p>
      <blockquote>1) 2:1 scaling only applies to the automatic data reporting 
in Stream mode. It does not effect the reported data sent in response to the
"Read Data" (0xEB) command. 
        <p>2)&nbsp; The mouse and host do not buffer "Resend" (0xFF) commands. 
This means "0xFE" will never be sent in response to the "Resend" command.&nbsp; 
        </p>
        <p>3)&nbsp;&nbsp; A "packet" may be a 3-byte movement data packet,
a 4-byte movement data packet (for the Intellimouse), a 3-byte status packet
(see "Status Request" [0xE9] command) a 2-byte completion-code-ID packet
(0xAA,0x00 or 0xFC,0x00), or a 1-byte response to a command. </p>
        <p>4)&nbsp; A little advice from my own experience...&nbsp; Even
though bit 3 of the first byte in a movement data packet is supposed to be
set, some drivers (such as the standard PS/2 mouse driver included with Windows 
98SE) don't care and just ignore that bit.&nbsp; However, other drivers do
check that bit and if it is not set, it is considered an error.&nbsp; I mention
this so that, if you're designing a mouse, you double-check that this bit
is set in every movement data packet sent by your mouse.&nbsp; If it is not,
your mouse may work properly when you test it on your computer, but it may
not work on other computers that use different mouse drivers.&nbsp; </p>
        <p>For example, if using MS Intellimouse drivers and bit 3 of the
first byte in a movement data packet is not set, the driver will discard
that packet, then send the "Disable Data Reporting"&nbsp; (0xF5) command,
followed by the "Set Defaults" (0xF6) command, then it will reinitialize
the mouse using the same command sequence as it does when Windows boots up
(see the "Initialization" section above.)</p>
      </blockquote>
 <b>Other Sources / References:</b> 
      <ul>
 <li> <a href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/">Adam's
micro-Resources Home</a> - This site's homepage.</li>
        <li> <a
 href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/PS2/ps2.htm">PS/2 
Mouse/Keyboard Protocol</a> - Protocol used by AT and PS/2 keyboards.</li>
        <li> <a
 href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/PICmicro/code/code.html">Mouse
Code/Projects</a> - My mouse projects and source code.</li>
      </ul>
  
      <ul>
        <li><a href="http://www.holtek.com/products/computer/">Holtek</a>
- Informative datasheets on many different PS/2 mice (and other peripherals).</li>
        <li> <a href="http://www.emc.com.tw/product/p_pc_mc.asp">EMC</a>
- More inormative datasheets on many different PS/2 mice (and an ADB mouse).</li>
        <li> <a
 href="http://www.synaptics.com/decaf/utilities/tp-intf2-4.PDF">Synaptics 
Touchpad Interfacing Guide</a> -Very informative!</li>
      </ul>
  
      <ul>
        <li> <a href="http://panda.cs.ndsu.nodak.edu/%7Eachapwes/">Adam Chapweske's
Homepage</a> - Information about me.</li>
        <li> <a href="mailto:achapwes@panda.cs.ndsu.nodak.edu">Email me</a>
- Questions/comments?</li>
      </ul>
      <ul>
   
      </ul>
 </td>
 </tr>
 
  </tbody>
</table>
    
<p><br>
 </p>
<br>
</body>
</html>
